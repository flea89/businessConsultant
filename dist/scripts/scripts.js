"use strict";angular.module("publicApp",["ngResource"]).config(function(t){t.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/addCustomer",{templateUrl:"views/addCustomer.html",controller:"AddCustomerCtrl"}).when("/customerList",{templateUrl:"views/customerList.html",controller:"CustomerListCtrl"}).when("/modifyCustomer/:id",{templateUrl:"views/modifyCustomer.html",controller:"ModifyCustomerCtrl"}).when("/createBill",{templateUrl:"views/createBill.html",controller:"CreateBillCtrl"}).when("/administrator/:id",{templateUrl:"views/administrator.html",controller:"AdministratorCtrl"}).when("/customerDetail/:id",{templateUrl:"views/customerDetail.html",controller:"CustomerDetailCtrl"}).when("/testDb",{templateUrl:"views/testDb.html",controller:"TestDbCtrl"}).otherwise({redirectTo:"/"})}),angular.module("publicApp").factory("Customer",["$resource",function(t){return t("/users/:id",{id:"@id"},{update:{method:"PUT",params:{admin:"@admin"}},getChanges:{method:"GET",params:{modifiedSince:"@modifiedSince"},isArray:!0}})}]),angular.module("publicApp").controller("MainCtrl",["$scope",function(t){t.awesomeThings=["HTML5 Boilerplate","AngularJS","Testacular"]}]),angular.module("publicApp").filter("upperCase",[function(){return function(t){return"upperCase filter: "+t}}]),angular.module("publicApp").controller("AddCustomerCtrl",["$scope","$rootScope","Customer","$route",function(t,e,n,r){t.success,t.user={type:"private",address:{streetType:"Via"}},t.isNotSociety=function(){return"Societa"!==t.user.title},t.addCustomer=function(){e.pBarStatus="progress-info",e.pBarActive="active",e.pBarVisibility="";var i=JSON.stringify(t.user);t.success=n.save([],{user:i},function(t){"ok"===t.result?(e.pBarActive="",e.pBarStatus="progress-success",r.reload()):(e.pBarActive="",e.pBarStatus="progress-danger",alert("error!!")),setTimeout(function(){e.pBarVisibility="hidden",e.$apply()},2e3)})}}]),angular.module("publicApp").directive("navBar",[function(){return{template:"<div></div>",restrict:"E",link:function(t,e){e.text("this is the navBar directive")}}}]),angular.module("publicApp").controller("CustomerListCtrl",["$scope","$location","Customer","$route","gStorage",function(t,e,n,r,i){t.customers=i.getCollection("customer"),t.query={type:"all"},t.getCustomers=function(){var e=t.query.type,n=function(t){return t.hasOwnProperty("type")?"private"===t.type:void 0},r=function(t){return t.hasOwnProperty("type")?"professional"===t.type:!1};return"all"===e||"private"!==e&&"professional"!==e?t.customers:"private"===e?t.customers.filter(n):t.customers.filter(r)},t.linkModify=function(t){e.path("modifyCustomer/"+t)},t.deleteCustomer=function(e){var r=$(".progress");r.removeClass("hidden"),n.delete({id:e},function(e){"ok"===e.result?(r.removeClass("progress-info"),r.removeClass("active"),r.addClass("progress-success"),t.customers=n.query()):(r.addClass("danger-success"),alert("error!!")),setTimeout(function(){r.removeClass("progress-success"),r.removeClass("danger-success"),r.addClass("hidden"),r.addClass("progress-info"),r.addClass("active")},2e3)})}}]),angular.module("publicApp").controller("ModifyCustomerCtrl",["$scope","$routeParams","Customer","gStorage",function(t,e,n,r){t.user=r.getItem("customer",e.id),setTimeout(function(){console.log(t.user)},1e3),t.modifyCustomer=function(){var r=JSON.stringify(t.user);$(".progress").removeClass("hidden"),n.update({id:e.id,user:r},function(){$(".progress").addClass("hidden")})}}]),angular.module("publicApp").factory("barbero",[function(){var t=42;return{someMethod:function(){return t}}}]),angular.module("publicApp").directive("progressbar",[function(){return{restrict:"E",scope:{show:"=",status:"=",active:"="},template:'<div class="progress progress-striped {{active}} fixedprogress {{status}} {{show}} "><div class="bar" style="width: 100%;"></div></div>',link:function(t){t.show="hidden"}}}]),angular.module("publicApp").controller("CreateBillCtrl",["$scope","Admin","Customer","Bill",function(t,e,n,r){t.bill={customer:{},admin:{},type:"professional"},t.tasks=[{},{},{},{},{},{},{},{},{}],t.limiter=5,t.date=new Date,t.bill.admin=e.get({id:"5136191f2d2296145b85123a"}),t.customers=n.query(),t.setCustomer=function(e){t.bill.customer=t.customers.filter(function(t){return t._id===e})[0]},t.toogleLimit=function(){t.limiter=t.limiter+5},t.calculateTotal=function(){var e,n,r,i=t.tasks.reduce(function(t,e){return t+Number(e.quantity*e.cost)},0);return"private"===t.bill.type?(r=i+1.81,{totBill:i,finalPrice:r,ritenuta:0}):(e=.2*i,n=i-e,r=n+1.81,t.bill.tot=n,t.bill.finalPrice=r,t.bill.ritenuta=e,{totBill:n,finalPrice:r,ritenuta:e})},t.save=function(){t.bill.tasks=t.tasks.filter(function(t){return""!==t.quantity&&""!==t.cost&&""!==t.taskName?!0:!1});var e=angular.toJson(t.bill);r.save([],{bill:e},function(){})}}]),angular.module("publicApp").directive("contenteditable",[function(){return{restrict:"A",require:"?ngModel",link:function(t,e,n,r){function i(){r.$setViewValue(e.html())}r&&(r.$render=function(){e.html(r.$viewValue||"")},e.bind("blur keyup change",function(){t.$apply(i)}),i())}}}]),angular.module("publicApp").directive("cedit",[function(){return{restrict:"A",scope:{variable:"="},link:function(t,e){function n(){t.variable=e.html()}e.bind("blur keyup change",function(){t.$apply(n)})}}}]),angular.module("publicApp").factory("Bill",["$resource",function(t){return t("/bills/:id",{id:"@id"},{update:{method:"PUT",params:{bill:"@bill"}},getChanges:{method:"GET",params:{modifiedSince:"@modifiedSince"},isArray:!0}})}]),angular.module("publicApp").factory("Admin",["$resource",function(t){return t("/admin/:id",{id:"@id"},{update:{method:"PUT",params:{user:"@user"}}})}]),angular.module("publicApp").controller("AdministratorCtrl",["$scope","Admin","$routeParams",function(t,e,n){t.admin=e.get({id:n.id}),t.modifyCustomer=function(){var r=JSON.stringify(t.admin);e.update({id:n.id,admin:r})}}]),angular.module("publicApp").controller("CustomerDetailCtrl",["$scope","Customer","$routeParams","$location",function(t,e,n,r){t.customer=e.get({id:n.id}),t.linkModify=function(){r.path("modifyCustomer/"+t.customer._id)}}]),angular.module("publicApp").directive("online",[function(){return{restrict:"E",scope:{},template:'<button style="float: left" class="btn btn-{{onlineclass}} online" >{{onlineText}}</button>',link:function(t){var e="online",n="offline";/Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test(navigator.userAgent)&&(e="on",n="off"),t.onlineclass=window.navigator.onLine?"success":"danger",t.onlineText=window.navigator.onLine?e:n,window.addEventListener("offline",function(){t.$apply(function(){t.onlineclass="danger",t.onlineText=n})}),window.addEventListener("online",function(){t.$apply(function(){t.onlineclass="success",t.onlineText=e})})}}}]),angular.module("publicApp").factory("gStorage",["Customer","Bill","lStorage","$rootScope",function(t,e,n,r){var i={customer:t,bill:e};window.addEventListener("online",function(){o.sync("customer",function(){alert("mi sono sincronizzato i customer"),o.sync("bill",function(){alert("mi sono sincronizzato le fattue")})})});var o={getLastSync:function(t,e){n.getLastSync(t).then(function(t){e(t)})},getChanges:function(t,e,n){i[t].getChanges({modifiedSince:e},function(t){"ok"!==t.result?n(t):alert("bad request")},function(){alert("check your connection")})},applyChanges:function(t,e,r){n.addToCollection(r,t).then(function(){e(t)})},sync:function(t,e){var n=this;this.getLastSync(t,function(r){n.getChanges(t,r,function(r){n.applyChanges(r,e,t)})})},deleteLocalStorage:function(t){n.emptyCollection(t).then(function(){alert("removed "+t)})}},s={getCollection:function(t){var e=[];return window.navigator.onLine?o.sync(t,function(){n.getLocalCollection(t).then(function(t){t.forEach(function(t){e.push(t.toJSON())}),r.$digest()})}):n.getLocalCollection(t).then(function(t){t.forEach(function(t){e.push(t)}),r.$digest()}),e},getItem:function(t,e){var i={};return window.navigator.onLine?o.sync(t,function(){n.getLocalItem(t,e).then(function(t){angular.extend(i,t[0].toJSON()),r.$apply()})}):n.getLocalItem(t,e).then(function(t){angular.extend(i,t[0])}),i}};return{syncObj:o,getCollection:s.getCollection,getItem:s.getItem}}]),angular.module("publicApp").factory("lStorage",["jaydata",function(t){Array.prototype.max=function(t){return 0===this.length?0:Math.max.apply(Math,this.map(function(e){return e[t]}))};var e=function(e){return t.then(function(t){return t[e].filter(function(){return!0}).toArray()})},n=function(e){return t.then(function(t){var n=t[e].filter(function(){return!0}).toArray();return n.then(function(t){return t.max("sync")})})},r=function(e,n){var r=[],i=[];return n.forEach(function(t){r.push(new $org.types[e](t)),i.push(new $org.types[e]({_id:t._id}))}),t.then(function(t){i.forEach(function(n){t[e].remove(n)}),t.addMany(r),t.saveChanges()})},i=function(e){return t.then(function(t){var n=t[e].filter(function(){return!0}).toArray();return n.then(function(e){e.forEach(function(e){t.remove(e)}),t.saveChanges()})})},o=function(e,n){return t.then(function(t){return t[e].filter(function(t){return t._id===this.id},{id:n}).toArray()})};return{getLocalCollection:e,getLocalItem:o,getLastSync:n,addToCollection:r,emptyCollection:i}}]),angular.module("publicApp").controller("TestDbCtrl",["$scope","gStorage",function(t,e){t.sync=function(){e.syncObj.sync("customer",function(){alert("mi sono sincronizzato"),e.syncObj.sync("bill",function(){alert("mi sono sincronizzato le fattue")})})},t.remove=function(){e.syncObj.deleteLocalStorage(t.resource)}}]),angular.module("publicApp").factory("jaydata",["$q","$rootScope",function(t,e){var n=t.defer();return $data.Entity.extend("$org.types.customer",{_id:{type:"string",key:!0,required:!0},name:{type:"string"},surname:{type:"string"},type:{type:"string"},title:{type:"string"},cf:{type:"string"},pi:{type:"string"},mail:{type:"string"},telephone:{type:"string"},sync:{type:"int"},address:{type:"Array",elementType:"$org.types.address"}}),$data.Entity.extend("$org.types.address",{streetType:{type:"string"},streetName:{type:"string"},cap:{type:"string"},streetNumber:{type:"string"},city:{type:"string"},provincia:{type:"string"}}),$data.Entity.extend("$org.types.admin",{_id:{type:"string",key:!0,required:!0},name:{type:"string"},surname:{type:"string"},cf:{type:"string"},pi:{type:"string"},sync:{type:"int"},address:{type:"Array",elementType:"$org.types.address"}}),$data.Entity.extend("$org.types.task",{Id:{type:"int",key:!0,computed:!0},quantity:{type:"string"},taskName:{type:"string"},cost:{type:"string"}}),$data.Entity.extend("$org.types.bill",{_id:{type:"string",key:!0,required:!0},type:{type:"string"},customer:{type:"Array",elementType:"$org.types.customer"},admin:{type:"Array",elementType:"$org.types.admin"},tasks:{type:"Array",elementType:"$org.types.task"},finalPrice:{type:"string"},ritenuta:{type:"string"},tot:{type:"string"},sync:{type:"string"}}),$data.EntityContext.extend("$org.types.OrgContext",{customer:{type:$data.EntitySet,elementType:$org.types.customer},bill:{type:$data.EntitySet,elementType:$org.types.bill}}),$org.context=$org.context=new $org.types.OrgContext({name:"webSql",databaseName:"Business"}),$org.context.onReady(function(){n.resolve($org.context),e.$digest()}),n.promise}]);