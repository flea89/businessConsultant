"use strict";angular.module("publicApp",["ngResource"]).config(function(t){t.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/addCustomer",{templateUrl:"views/addCustomer.html",controller:"AddCustomerCtrl"}).when("/customerList",{templateUrl:"views/customerList.html",controller:"CustomerListCtrl"}).when("/modifyCustomer/:id",{templateUrl:"views/addCustomer.html",controller:"ModifyCustomerCtrl"}).when("/createBill/:id",{templateUrl:"views/createBill.html",controller:"CreateBillCtrl"}).when("/createBill/",{templateUrl:"views/createBill.html",controller:"CreateBillCtrl"}).when("/administrator/:id",{templateUrl:"views/administrator.html",controller:"AdministratorCtrl"}).when("/customerDetail/:id",{templateUrl:"views/customerDetail.html",controller:"CustomerDetailCtrl"}).when("/billDetails/:id",{templateUrl:"views/billDetails.html",controller:"BillDetailsCtrl"}).when("/billList",{templateUrl:"views/billList.html",controller:"BillListCtrl"}).otherwise({redirectTo:"/"})}),angular.module("publicApp").factory("Customer",["$resource",function(t){return t("/users/:id",{id:"@id"},{update:{method:"PUT"}})}]),angular.module("publicApp").controller("MainCtrl",["$scope",function(t){t.awesomeThings=["HTML5 Boilerplate","AngularJS","Testacular"]}]),angular.module("publicApp").filter("upperCase",[function(){return function(t){return"upperCase filter: "+t}}]),angular.module("publicApp").controller("AddCustomerCtrl",["$scope","$rootScope","Customer","$route",function(t,e,r,i){t.success,t.user={type:"private",address:{streetType:"Via"}},t.isNotSociety=function(){return"Societa"!==t.user.title},t.submit=function(){e.pBarStatus="progress-info",e.pBarActive="active",e.pBarVisibility="";var n=JSON.stringify(t.user);t.success=r.save([],{user:n},function(t){"ok"===t.result?(e.pBarActive="",e.pBarStatus="progress-success",i.reload()):(e.pBarActive="",e.pBarStatus="progress-danger",alert("error!!")),setTimeout(function(){e.pBarVisibility="hidden",e.$apply()},2e3)})}}]),angular.module("publicApp").directive("navBar",[function(){return{template:"<div></div>",restrict:"E",link:function(t,e){e.text("this is the navBar directive")}}}]),angular.module("publicApp").controller("CustomerListCtrl",["$scope","$location","Customer","$route",function(t,e,r){t.customers=r.query(),t.query={type:"all"},t.getCustomers=function(){var e=t.query.type,r=function(t){return t.hasOwnProperty("type")?"private"===t.type:void 0},i=function(t){return t.hasOwnProperty("type")?"professional"===t.type:!1};return"all"===e||"private"!==e&&"professional"!==e?t.customers:"private"===e?t.customers.filter(r):t.customers.filter(i)},t.linkModify=function(t){e.path("modifyCustomer/"+t)},t.createBill=function(t){e.path("createBill/"+t)},t.deleteCustomer=function(e){var i=$(".progress");i.removeClass("hidden"),r.delete({id:e},function(e){"ok"===e.result?(i.removeClass("progress-info"),i.removeClass("active"),i.addClass("progress-success"),t.customers=r.query()):(i.addClass("danger-success"),alert("error!!")),setTimeout(function(){i.removeClass("progress-success"),i.removeClass("danger-success"),i.addClass("hidden"),i.addClass("progress-info"),i.addClass("active")},2e3)})}}]),angular.module("publicApp").controller("ModifyCustomerCtrl",["$scope","$routeParams","Customer",function(t,e,r){t.user=r.get({id:e.id}),t.isNotSociety=function(){return"Societa"!==t.user.title},t.submit=function(){var i=JSON.stringify(t.user);$(".progress").removeClass("hidden"),r.update({id:e.id,user:i},function(){$(".progress").addClass("hidden")})}}]),angular.module("publicApp").factory("barbero",[function(){var t=42;return{someMethod:function(){return t}}}]),angular.module("publicApp").directive("progressbar",[function(){return{restrict:"E",scope:{show:"=",status:"=",active:"="},template:'<div class="progress progress-striped {{active}} fixedprogress {{status}} {{show}} "><div class="bar" style="width: 100%;"></div></div>',link:function(t){t.show="hidden"}}}]),angular.module("publicApp").controller("CreateBillCtrl",["$scope","Admin","Customer","Bill","$routeParams","$route","$rootScope",function(t,e,r,i,n,l,o){t.bill={customer:{},admin:{},date:new Date,type:"professional"},i.setCurrentBillNumber(t.bill),t.tasks=[{},{},{},{},{},{},{},{},{}],t.limiter=5,t.date=new Date,t.bill.admin=e.get({id:"5136191f2d2296145b85123a"}),t.customers=r.query(function(e){i.setCurrentBillNumber(t.bill),t.bill.customer=e.filter(function(t){return t._id===n.id})[0]}),t.setCustomer=function(e){t.bill.customer=t.customers.filter(function(t){return t._id===e})[0]},t.toogleLimit=function(){t.limiter=t.limiter+5},t.calculateTotal=function(){var e,r,i,n,l,o=t.tasks.reduce(function(t,e){return n=Number(e.quantity)===Number(e.quantity)?""===e.quantity?1:e.quantity:1,l=Number(e.quantity)===Number(e.quantity)?e.cost:0,t+Number(n*l)},0);return"private"===t.bill.type?(i=o+1.81,{totBill:o,finalPrice:i,ritenuta:0}):(e=.2*o,r=o-e,i=r+1.81,t.bill.tot=r,t.bill.finalPrice=i,t.bill.ritenuta=e,{totBill:r,finalPrice:i,ritenuta:e})},t.save=function(){return t.bill.customer==={}||void 0===t.bill.customer?(alert("Devi inserire un cliente"),void 0):(o.pBarStatus="progress-info",o.pBarActive="active",o.pBarVisibility="",t.bill.tasks=t.tasks.filter(function(t){return""!==t.quantity&&""!==t.cost&&""!==t.taskName?!0:!1}),i.addBill(t.bill,function(t){"no"===t.result?(o.pBarActive="",o.pBarStatus="progress-danger",alert("error!!")):(o.pBarActive="",o.pBarStatus="progress-success",l.reload()),setTimeout(function(){o.pBarVisibility="hidden",o.$apply()},2e3),l.reload()},function(){}),void 0)}}]),angular.module("publicApp").directive("contenteditable",[function(){return{restrict:"A",require:"?ngModel",link:function(t,e,r,i){function n(){i.$setViewValue(e.html())}i&&(i.$render=function(){e.html(i.$viewValue||"")},e.bind("blur keyup change",function(){t.$apply(n)}),n())}}}]),angular.module("publicApp").directive("cedit",[function(){return{restrict:"A",scope:{variable:"="},link:function(t,e){function r(){t.variable=e.html()}e.bind("blur keyup change",function(){t.$apply(r)})}}}]),angular.module("publicApp").factory("Bill",["$resource","$rootScope",function(t){var e=t("/bills/:id",{id:"@id"},{update:{method:"PUT"}});Array.prototype.max=function(t){return 0===this.length?0:Math.max.apply(Math,this.map(function(e){return e[t]}))};var r=[],i=function(t,i){return 0!==r.length?(t(r),r):r=e.query({},function(e){t(e)},function(t){i(t)})},n=function(t,i,n){var l=angular.toJson(t);e.save([],{bill:l},function(t){r.push(t),i(t)},function(t){n(t)})},l=function(t){0===r.length?i(function(e){0===e.length?alert("error retreiving bill number"):t.number=r.max("number")+1},function(){}):t.number=r.max("number")+1};return{resource:e,queryAll:i,setCurrentBillNumber:l,addBill:n}}]),angular.module("publicApp").factory("Admin",["$resource",function(t){return t("/admin/:id",{id:"@id"},{update:{method:"PUT",params:{user:"@user"}}})}]),angular.module("publicApp").controller("AdministratorCtrl",["$scope","Admin","$routeParams",function(t,e,r){t.admin=e.get({id:r.id}),t.modifyCustomer=function(){var i=JSON.stringify(t.admin);e.update({id:r.id,admin:i})}}]),angular.module("publicApp").controller("CustomerDetailCtrl",["$scope","Customer","$routeParams","$location","Bill",function(t,e,r,i,n){t.customer=e.get({id:r.id},function(){t.customer.bills=n.resource.query({bill:JSON.stringify({"customer._id":t.customer._id})},function(t){console.log(t)},function(){console.log("fail")})}),t.linkModify=function(){i.path("modifyCustomer/"+t.customer._id)},t.detail=function(t){i.path("billDetails/"+t)}}]),angular.module("publicApp").directive("online",[function(){return{restrict:"E",scope:{},template:'<button style="float: left" class="btn btn-{{onlineclass}} online" >{{onlineText}}</button>',link:function(t){var e="online",r="offline";/Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test(navigator.userAgent)&&(e="on",r="off"),t.onlineclass=window.navigator.onLine?"success":"danger",t.onlineText=window.navigator.onLine?e:r,window.addEventListener("offline",function(){t.$apply(function(){t.onlineclass="danger",t.onlineText=r})}),window.addEventListener("online",function(){t.$apply(function(){t.onlineclass="success",t.onlineText=e})})}}}]),angular.module("publicApp").controller("BillDetailsCtrl",["$scope","Bill","$routeParams",function(t,e,r){t.tasks=[{},{},{},{},{},{},{},{},{}],t.bill=e.resource.get({id:r.id},function(e){console.log(e),e.tasks.forEach(function(e,r){angular.extend(t.tasks[r],e)})}),t.calculateTotal=function(){var e,r,i,n=t.tasks.reduce(function(t,e){return t+Number(e.quantity*e.cost)},0);return"private"===t.bill.type?(i=n+1.81,{totBill:n,finalPrice:i,ritenuta:0}):(e=.2*n,r=n-e,i=r+1.81,t.bill.tot=r,t.bill.finalPrice=i,t.bill.ritenuta=e,{totBill:r,finalPrice:i,ritenuta:e})},t.modify=function(){t.bill.tasks=t.tasks.filter(function(t){return""!==t.quantity&&""!==t.cost&&""!==t.taskName?!0:!1});var r=angular.toJson(t.bill);e.update({id:t.bill._id,bill:r},function(){},function(){})}}]),angular.module("publicApp").controller("BillListCtrl",["$scope","Bill","$location","$rootScope",function(t,e,r,i){t.bills=function(){var t=[];return i.pBarStatus="progress-info",i.pBarActive="active",i.pBarVisibility="",e.queryAll(function(e){i.pBarVisibility="hidden",e.forEach(function(e){t.push(e)})},function(){}),t}(),t.detail=function(t){r.path("billDetails/"+t)}}]);